<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown File Previewer</title>
    <link rel="stylesheet" href="style.css">
    <link id="hljs-theme" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Markdown File Previewer</h1>
        <div class="header-buttons">
            <button id="export-pdf" title="Export preview as PDF">Export PDF</button>
            <button id="theme-toggle" title="Toggle dark/light theme">Dark</button>
        </div>
    </div>
    <p>Select a Markdown file or type Markdown below to preview its rendered content.</p>
    <input type="file" id="file-input" accept=".md">
    <div class="editor-layout">
        <textarea id="editor" placeholder="Type or paste Markdown here..."></textarea>
        <div id="preview"></div>
    </div>
</div>

    <script>
        const fileInput = document.getElementById('file-input');
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');
        const themeToggle = document.getElementById('theme-toggle');
        const hljsTheme = document.getElementById('hljs-theme');

        function setTheme(dark) {
            document.body.classList.toggle('dark', dark);
            themeToggle.textContent = dark ? 'Light' : 'Dark';
            hljsTheme.href = dark
                ? 'https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/github-dark.min.css'
                : 'https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/github.min.css';
            localStorage.setItem('theme', dark ? 'dark' : 'light');
        }

        themeToggle.addEventListener('click', function () {
            setTheme(!document.body.classList.contains('dark'));
        });

        setTheme(localStorage.getItem('theme') === 'dark');

        document.getElementById('export-pdf').addEventListener('click', function () {
            const printWindow = window.open('', '_blank');
            printWindow.document.write('<!DOCTYPE html><html><head><title>Markdown Preview</title>');
            printWindow.document.write('<style>body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;line-height:1.6;max-width:800px;margin:0 auto;padding:2rem;color:#333}pre{background:#f0f0f0;padding:1em;border-radius:6px;overflow-x:auto}code{background:#f0f0f0;padding:0.15em 0.4em;border-radius:3px;font-size:0.9em}pre code{background:none;padding:0}blockquote{border-left:4px solid #ddd;padding-left:1em;color:#666}img{max-width:100%;height:auto}</style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write(preview.innerHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        });

        marked.setOptions({
            highlight: function (code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    return hljs.highlight(code, { language: lang }).value;
                }
                return hljs.highlightAuto(code).value;
            }
        });

        function renderPreview() {
            preview.innerHTML = marked.parse(editor.value);
        }

        editor.addEventListener('input', renderPreview);

        fileInput.addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                editor.value = e.target.result;
                renderPreview();
            };
            reader.readAsText(file);
        });
    </script>
</body>
</html>
